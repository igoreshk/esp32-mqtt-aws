# ESP32 AWS IoT MQTT –∏ BLE —à–ª—é–∑

[![–°—Ç–∞—Ç—É—Å: –†–∞–Ω–Ω—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞](https://img.shields.io/badge/—Å—Ç–∞—Ç—É—Å-—Ä–∞–Ω–Ω—è—è_—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞-yellow)](https://github.com/igoreshk/esp32-mqtt-aws)
[![–Ø–∑—ã–∫–∏: C++/Python](https://img.shields.io/badge/—è–∑—ã–∫–∏-C%2B%2B%2FPython-blue)](https://github.com/igoreshk/esp32-mqtt-aws)
[![–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ø–Ω–≤–∞—Ä—å 2024](https://img.shields.io/badge/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-—è–Ω–≤–∞—Ä—å_2024-lightgrey)](https://github.com/igoreshk/esp32-mqtt-aws)
[![–ö–æ–º–º–∏—Ç–æ–≤: 5](https://img.shields.io/badge/–∫–æ–º–º–∏—Ç–æ–≤-5-green)](https://github.com/igoreshk/esp32-mqtt-aws)

> –ü—Ä–æ–µ–∫—Ç –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ ESP32, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å AWS IoT Core –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É MQTT, —Ä–∞–±–æ—Ç—É —Å Bluetooth Low Energy (BLE) —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üìÅ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#-—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
- [üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
- [üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏](#Ô∏è-–≤–∞–∂–Ω—ã–µ-–∑–∞–º–µ—Ç–∫–∏)
- [üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç–∞—Ç—É—Å-–ø—Ä–æ–µ–∫—Ç–∞)
- [üîó –°—Å—ã–ª–∫–∏](#-—Å—Å—ã–ª–∫–∏)

---

## üìÅ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| **`esp-aws-mqtt.ino`** | –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫–µ—Ç—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AWS IoT Core —á–µ—Ä–µ–∑ MQTT |
| **`esp32_mqtt_cons.ino`** | –ü—Ä–∏–º–µ—Ä MQTT-–∫–ª–∏–µ–Ω—Ç–∞ (Consumer) |
| **`esp32_mqtt_serv.ino`** | –ü—Ä–∏–º–µ—Ä MQTT-—Å–µ—Ä–≤–µ—Ä–∞ (Broker) |
| **`esp32_BLE_switchstatusreceived.ino`** | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç–∞—Ç—É—Å–∞ BLE-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è |
| **`esp32_iBeacon_servicedata_deepsleep_test.ino`** | –¢–µ—Å—Ç –¥–ª—è iBeacon, —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ä–µ–∂–∏–º–∞ –≥–ª—É–±–æ–∫–æ–≥–æ —Å–Ω–∞ |
| **`aws_alpn_gatt.py`** | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ Python –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ALPN –∏ GATT |

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–ª–∞–∫–æ**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ AWS IoT Core —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É X.509
- ‚úÖ **–†–∞–±–æ—Ç–∞ —Å Bluetooth**: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, iBeacon)
- ‚úÖ **–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –≥–ª—É–±–æ–∫–æ–≥–æ —Å–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- ‚úÖ **–†–æ–ª—å —à–ª—é–∑–∞**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ MQTT-—Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –æ–±–ª–∞–∫–æ

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### üéØ –¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **ESP32 –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**

### üíª –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
| –Ø–∑—ã–∫ | –î–æ–ª—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------|------------|
| **C++** | 70.2% | –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ ESP32 |
| **Python** | 29.8% | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ —Ç–µ—Å—Ç—ã |

### üì° –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- **MQTT —á–µ—Ä–µ–∑ TLS** ‚Äì –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–≤—è–∑—å —Å AWS IoT Core
- **Bluetooth Low Energy (BLE/GATT)** ‚Äì –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Bluetooth-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- **ALPN (Application-Layer Protocol Negotiation)** ‚Äì –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AWS

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Arduino IDE –∏–ª–∏ PlatformIO —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–ª–∞—Ç ESP32
# –î–ª—è PlatformIO:
pio platform install espressif32

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AWS
#–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ "–í–µ—â—å" (Thing) –≤ —Å–µ—Ä–≤–∏—Å–µ AWS IoT Core
#–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏ —Å–∫–∞—á–∞–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (X.509)
#–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ø–æ–ª–∏—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø–∞ (IAM Policy)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã WiFi –≤ –∫–æ–¥–µ:
const char* ssid = "–í–ê–®_SSID";
const char* password = "–í–ê–®_–ü–ê–†–û–õ–¨";
# 2. –î–æ–±–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ AWS:
const char* awsEndpoint = "–≤–∞—à-—ç–Ω–¥–ø–æ–∏–Ω—Ç.iot.—Ä–µ–≥–∏–æ–Ω.amazonaws.com";
const char* certificate = R"EOF(-----BEGIN CERTIFICATE----- ...)EOF";
const char* privateKey = R"EOF(-----BEGIN RSA PRIVATE KEY----- ...)EOF";
### 4. –ü—Ä–æ—à–∏–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
–°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Arduino IDE –∏–ª–∏ PlatformIO
–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ—à–∏–≤–∫—É –Ω–∞ –ø–ª–∞—Ç—É ESP32
–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ —á–µ—Ä–µ–∑ Serial Monitor (115200 baud)
